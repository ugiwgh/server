call mtr.add_suppression("Can't init tc log");
call mtr.add_suppression("Aborting");
call mtr.add_suppression("tc-heuristic-recover: Failed to open the binlog");
call mtr.add_suppression("Heuristic BINLOG_TRUNCATE crash recovery failed. Error:");
call mtr.add_suppression("InnoDB: Error: Table .*mysql.*innodb_table_stats.*not found");
call mtr.add_suppression("InnoDB: New log files created");
call mtr.add_suppression("InnoDB: Creating foreign key constraint system tables.");
RESET MASTER;
CREATE TABLE t1 (a INT PRIMARY KEY, b MEDIUMTEXT) ENGINE=Innodb;
INSERT INTO t1 VALUES (1,'dummy');
SET DEBUG_SYNC= "commit_after_release_LOCK_log SIGNAL con1_ready WAIT_FOR con1_go";
INSERT INTO t1 VALUES (2,'dummy');
SET DEBUG_SYNC= "now WAIT_FOR con1_ready";
"List of binary logs"
show binary logs;
Log_name	File_size
master-bin.000001	#
# Kill the server
NOT FOUND /tc-heuristic-recover: Truncated binlog File: \.\/master\-bin\.000001 of Size:[0-9]*, to Position */ in mysqld.1.err
"One row shoule be present in table"
SELECT COUNT(*) FROM t1;
COUNT(*)
2
"Two gtids should be present 0-1-2, one for CREATE and the other for INSERT"
SELECT @@GLOBAL.gtid_current_pos;
@@GLOBAL.gtid_current_pos
0-1-3
DROP TABLE t1;
"Three gtids should be present 0-1-3 after table 't1' is dropped."
SELECT @@GLOBAL.gtid_binlog_state;
@@GLOBAL.gtid_binlog_state
0-1-4
